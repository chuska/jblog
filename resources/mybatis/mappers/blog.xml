<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="blog">
	<!-- blogMainList -->
	<select id="mainList" parameterType="string" resultType="map">
	
		select C.USER_NAME ,
		   TO_CHAR(D.MODIFIED_DATE,'yyyy/mm/dd') AS MODIFIED_DATE,
		   D.POST_NO, 
		   D.TITLE
		   from 
				(select A.*, B.CATEGORY_NO from 
				(select b.BLOG_NO, a.USER_NAME 
					from blog_user a, blog b where a.USER_NO = b.BLOG_NO) A,
					CATEGORY B WHERE A.BLOG_NO = B.BLOG_NO AND B.CATEGORY_NO =#{categoryNo }) C,
				POST D WHERE C.CATEGORY_NO = D.CATEGORY_NO
	
	</select>
	
	<!-- blogCategoryList -->
	
	<select id="categoryList" parameterType="long" resultType="CategoryVo">
		select CATEGORY_NO as categoryNo, CATEGORY_NAME as categoryName 
		from category where BLOG_NO = #{blogNo }
	</select>
	
	
	<select id="commentCount" resultType="map">
		select POST_NO,COUNT(comments_no) as commentCnt from
		(select POST_NO ,COMMENTS_NO
			from COMMENTS  
			where POST_NO in (select POST_NO from post a, CATEGORY b where  a.CATEGORY_NO = #{categoryNo }))  
		GROUP BY POST_NO
	</select>
</mapper>